# R3LAY-001: Encrypted Broadcast Announcements

- Author: replghost
- Status: Draft
- Version: 1
- Created: 2025-11-15

## 1. Abstract

R3LAY Protocol v1 defines a minimal, chain-anchored, end-to-end encrypted **broadcast** mechanism:

- Creators publish encrypted announcements to their followers.
- Announcements are:
  - signed by a Substrate identity,
  - anchored on-chain via a smart contract event,
  - stored off-chain as ciphertext,
  - replayable and verifiable by any client.

The protocol focuses on **one-to-many broadcast feeds** (e.g. newsletters, “Substack”, channels), not on replies, chat, or social graph logic.

---

## 2. Motivation

Existing email / newsletter systems:

- rely on central servers to relay and store content,
- provide weak authenticity (DKIM/SPF) and limited E2E encryption,
- do not allow independent clients to verify history against a canonical ledger.

R3LAY aims to:

- provide a **transport-agnostic**, **server-agnostic** broadcast protocol,
- use a blockchain as a **public, immutable index** of announcements,
- keep message content **E2E encrypted** and stored off-chain,
- allow any client to reconstruct a creator’s feed from chain + storage alone.

---

## 3. Roles

### 3.1 Creator

A Creator:

- controls a **Substrate account** (`AccountId32`, SS58-encoded for UX),
- publishes encrypted announcements for followers,
- maintains one or more **Audience Epoch Keys (AEKs)** for follower sets,
- rotates AEKs when access should change (revocation, membership changes).

### 3.2 Follower

A Follower:

- controls a **Substrate account** and an **X25519 encryption key**,
- follows one or more Creators (follow semantics are out of scope in v1),
- receives **AEK tickets** granting access to specific epochs,
- decrypts and reads announcements from Creators.

### 3.3 Chain

A blockchain (e.g. Paseo Asset Hub with pallet-revive / REVM) hosts:

- a minimal **R3LAY Announcement Contract**,
- which emits `Announced` events with:
  - creator identity,
  - epoch,
  - content CID,
  - content hash,
  - Substrate-layer signature.

The chain:

- provides canonical ordering of announcements,
- acts as a tamper-evident log for verification and historical replay.

### 3.4 Storage Layer

A content-addressed storage system (e.g. IPFS, Statement Store) is used for:

- encrypted envelopes (`envelope.json`),
- encrypted bodies (`body.bin`),
- encrypted attachments,
- encrypted AEK tickets in follower mailboxes.

Storage is assumed to be untrusted; all confidentiality and integrity checks are done client-side.

### 3.5 Client

A R3LAY client:

- connects to the chain (via RPC or light client, e.g. smoldot),
- maintains a **local index** of `Announced` events,
- fetches ciphertext blobs from the storage layer,
- performs all cryptographic verification and decryption,
- presents feeds and archives to the user.

---

## 4. Identities

### 4.1 Substrate Identity

- Canonical on-chain identity: `AccountId32` (32 bytes).
- Human-friendly form: SS58-encoded string.
- Used for:
  - signing envelopes (authenticity),
  - identifying creators in `Announced` events.

### 4.2 Encryption Identity

- Long-term encryption identity: X25519 keypair.
- Public part is shared via a prekey bundle or registration mechanism (out of scope).
- Used to:
  - derive shared secrets for AEK tickets,
  - decrypt AEK tickets and access epochs.

---

## 5. On-chain: Announcement Contract

### 5.1 Requirements

The on-chain component:

- MUST emit an `Announced` event with:
  - `substrateAccount` (32-byte AccountId),
  - `epoch` (AEK epoch),
  - `cid` (string, pointer to envelope/body directory),
  - `contentHash` (32-byte hash of envelope+body),
  - `sig` (Substrate signature bytes).

- SHOULD be as simple as possible:
  - no business logic,
  - no on-chain decryption,
  - no dependence on follower state.

### 5.2 Minimal Solidity Interface (REVM / pallet-revive)

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

/// @title R3LAY Protocol v1 - Announcement Contract
/// @notice Minimal contract to anchor encrypted broadcast messages on-chain.
///         Identities are Substrate AccountId32, carried as bytes32.
contract R3layV1 {
    event Announced(
        bytes32 indexed substrateAccount,
        uint32 epoch,
        string cid,
        bytes32 contentHash,
        bytes sig
    );

    function announce(
        bytes32 substrateAccount,
        uint32 epoch,
        string calldata cid,
        bytes32 contentHash,
        bytes calldata sig
    ) external {
        emit Announced(substrateAccount, epoch, cid, contentHash, sig);
    }
}
